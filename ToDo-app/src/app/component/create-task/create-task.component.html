<div class="container py-4">
  <h2 class="mb-4">Create New Task</h2>
  <form [formGroup]="taskForm" (ngSubmit)="createTask()" class="needs-validation" novalidate>
    <!-- Title -->
    <div class="mb-3">
      <label for="title" class="form-label">Title</label>
      <input
        id="title"
        type="text"
        formControlName="title"
        class="form-control"
        [ngClass]="{'is-invalid': taskForm.get('title')?.touched && taskForm.get('title')?.invalid}"
        placeholder="Enter task title"
      />
      <div *ngIf="taskForm.get('title')?.touched && taskForm.get('title')?.invalid" class="text-danger mt-1">
        <div *ngIf="taskForm.get('title')?.errors?.['required']">Title is required.</div>
        <div *ngIf="taskForm.get('title')?.errors?.['minlength']">Title must be at least 3 characters.</div>
        <div *ngIf="taskForm.get('title')?.errors?.['maxlength']">Title cannot exceed 50 characters.</div>
      </div>
    </div>

    <!-- Content -->
    <div class="mb-3">
      <label for="content" class="form-label">Content</label>
      <textarea
        id="content"
        formControlName="content"
        class="form-control"
        [ngClass]="{'is-invalid': taskForm.get('content')?.touched && taskForm.get('content')?.invalid}"
        placeholder="Enter task description"
        rows="4"
      ></textarea>
      <div *ngIf="taskForm.get('content')?.touched && taskForm.get('content')?.invalid" class="text-danger mt-1">
        <div *ngIf="taskForm.get('content')?.errors?.['required']">Content is required.</div>
        <div *ngIf="taskForm.get('content')?.errors?.['minlength']">Content must be at least 10 characters.</div>
        <div *ngIf="taskForm.get('content')?.errors?.['maxlength']">Content cannot exceed 500 characters.</div>
      </div>
    </div>

    <!-- Category -->
    <div class="mb-3">
      <label for="category" class="form-label">Category</label>
      <select
        id="category"
        formControlName="category"
        class="form-select"
        [ngClass]="{'is-invalid': taskForm.get('category')?.touched && taskForm.get('category')?.invalid}"
      >
        <option value="" disabled>Select category</option>
        <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
      </select>
      <div *ngIf="taskForm.get('category')?.touched && taskForm.get('category')?.invalid" class="text-danger mt-1">
        Category is required.
      </div>
    </div>

    <!-- Priority -->
    <div class="mb-3">
      <label for="priority" class="form-label">Priority</label>
      <select
        id="priority"
        formControlName="priority"
        class="form-select"
        [ngClass]="{'is-invalid': taskForm.get('priority')?.touched && taskForm.get('priority')?.invalid}"
      >
        <option *ngFor="let priority of priorities" [value]="priority">{{ priority }}</option>
      </select>
      <div *ngIf="taskForm.get('priority')?.touched && taskForm.get('priority')?.invalid" class="text-danger mt-1">
        Priority is required.
      </div>
    </div>

    <!-- Tags -->
    <div class="mb-3">
      <label for="tags" class="form-label">Tags</label>
      <div class="input-group">
        <input
          id="tags"
          type="text"
          (keyup.enter)="addTag($event)"
          class="form-control"
          placeholder="Add a tag and press Enter"
        />
      </div>
      <div class="tag-list mt-2">
        <span
          *ngFor="let tag of taskForm.get('tags')?.value"
          class="badge bg-primary me-1"
        >
          {{ tag }}
          <button
            type="button"
            (click)="removeTag(tag)"
            class="btn-close btn-close-white ms-1"
            aria-label="Remove tag"
          ></button>
        </span>
      </div>
    </div>

    <!-- Status -->
    <div class="mb-3">
      <label for="status" class="form-label">Status</label>
      <select
        id="status"
        formControlName="status"
        class="form-select"
        [ngClass]="{'is-invalid': taskForm.get('status')?.touched && taskForm.get('status')?.invalid}"
      >
        <option *ngFor="let status of statuses" [value]="status">{{ status }}</option>
      </select>
      <div *ngIf="taskForm.get('status')?.touched && taskForm.get('status')?.invalid" class="text-danger mt-1">
        Status is required.
      </div>
    </div>

    <!-- Date -->
    <div class="mb-3">
      <label for="date" class="form-label">Date</label>
      <input
        id="date"
        type="datetime-local"
        formControlName="date"
        class="form-control"
        [ngClass]="{'is-invalid': taskForm.get('date')?.touched && taskForm.get('date')?.invalid}"
      />
      <div *ngIf="taskForm.get('date')?.touched && taskForm.get('date')?.invalid" class="text-danger mt-1">
        <div *ngIf="taskForm.get('date')?.errors?.['required']">Date is required.</div>
        <div *ngIf="taskForm.get('date')?.errors?.['minDate']">Date cannot be in the past.</div>
      </div>
    </div>

    <!-- Actions -->
    <div class="d-flex justify-content-end gap-2">
      <button
        type="button"
        (click)="cancel()"
        class="btn btn-secondary"
      >
        Cancel
      </button>
      <button
        type="submit"
        [disabled]="taskForm.invalid || isSubmitting"
        class="btn btn-primary"
      >
        {{ isSubmitting ? 'Creating...' : 'Create Task' }}
      </button>
    </div>
  </form>
</div>